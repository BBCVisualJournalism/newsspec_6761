(function(){function d(){var b=a.dom.get("#loading");var c=a.dom.get("#latest_casualties");b.hide();c.show();var d=a.dom.get("#mil_cas_selector input");a.events.addListener(d,"click",h);var f=a.dom.get(".facewall li");a.events.addListener(f,"click",e);i("loc_afghanistan");var g=a.dom.get("#navBar");if(a.env.ie){a.dom.get("#navBar").css("margin-left","20px")}new k("#navBar",{})}function e(d){if(b==true){c.hide()}var e=a.dom.get(d.attachedTo);var f=e.get("img").attr("title");if(f.match(/Not\sreleased/)){f="Not released"}var g=e.get("dl").clone();g.attr("class","panel_details");var h=e.get("a").clone();var i=a.dom.create('<div id="simplePanel">');var j=a.dom.create('<h2 class="hd">'+f+"</h2>");var k=e.get("input.ukmc-img-170-url").val();var l=a.dom.create("<img>").attr("src",k);var m=a.dom.create('<div class="bd">');m.append(l);m.append(g);var n=a.dom.create('<div class="ft">');n.append(h);i.append(j).append(m).append(n);c=new a.widgets.Panel(i,{theme:"light",width:450,modal:false});c.show();b=true}function f(b,c,d,e){var g=b*d;var h=g+d;if(h>=a.dom.get(c).length){c.slice(g).show();i(e)}else{c.slice(g,h).show();setTimeout(function(){f(++b,c,d,e)},70)}}function g(b,c,d,e){var f=b*d;var h=f+d;if(h>=a.dom.get(c).length){c.slice(f).hide();i(e)}else{c.slice(f,h).hide();setTimeout(function(){g(++b,c,d,e)},70)}}function h(b){var c=a.dom.get(b.attachedTo).attr("id");if(c=="loc_afghanistan"){g(0,a.dom.get(".iraq"),100,c);f(0,a.dom.get(".afghanistan"),100,c)}else if(c=="loc_iraq"){g(0,a.dom.get(".afghanistan"),100,c);f(0,a.dom.get(".iraq"),100,c)}else{f(0,a.dom.get(".afghanistan"),100,c);f(0,a.dom.get(".iraq"),100,c)}}function i(b){var c=b.substring(4);a.dom.get("#navBar").html("<h3>Fatalities by year</h3>");var d="<li class='ukcas-navbar-"+c+"' style='display:block;'></li>";a.dom.get(".year").each(function(b){var c=0;var e="";var f=a.dom.get(this).get(".yearSpan").html();a.dom.get("#navBar").append("<div class='ukcas-nav-collection' id='block"+b+"'></div>");a.dom.get("#navBar").get("#block"+b).append("<a href='#y"+f+"'>"+f+"</a>").append("<ul></ul>");a.dom.get(this).get("li").each(function(b){if(a.dom.get(this).css("display")!="none"){e+=d;c++}});a.dom.get("#navBar").get("#block"+b).get("ul").append(e);a.dom.get(this).get("h2").get(".deathCount").html(c+"")});a.dom.get("#navBar").append("<h5>Go to top</h5>");a.events.addListener(a.dom.get("#navBar").get("h5"),"click",j)}function j(){window.scrollTo(0,0)}function k(b,c){function e(){var d=parseInt(a.dom.get(window).height());var e=parseInt(a.dom.get(window).scrollTop());var f=parseInt(b.cont.offset().top);var g=parseInt(b.cont.item(0).offsetHeight);var h=parseInt(b.item(0).offsetHeight+(parseInt(b.css("margin-top"))||0)+(parseInt(b.css("margin-bottom"))||0));var i;c.offset=0;if(parseInt(b.initialOffsetTop)>=e+c.offset){i=parseInt(b.initialTop)}else{i=Math.min(Math.max(-f,e-parseInt(b.initialOffsetTop)+parseInt(b.initialTop))+c.offset,g-h-b.paddingAdjustment)}c.delay=0;if((new Date).getTime()-b.lastScroll>=c.delay-20){a.anim.css(b,.2,{top:i}).start()}}var b=a.dom.get(b);var d=b.css("position");b.cont=a.dom.get("#latest_casualties");b.initialTop=parseInt(b.css("top"))||0;b.initialOffsetTop=parseInt(b.offset().top);if(b.css("position")=="relative"){b.paddingAdjustment=parseInt(b.cont.css("paddingTop"))+parseInt(b.cont.css("paddingBottom"))}else{b.paddingAdjustment=0}window.onscroll=function(){l.interval=setTimeout(function(){e()},0);b.lastScroll=(new Date).getTime()};window.onresize=function(){l.interval=setTimeout(function(){e()},c.delay);b.lastScroll=(new Date).getTime()};b.lastScroll=0;e()}var a;var b=false;var c;gloader.load(["glow","1","glow.dom","glow.events","glow.widgets","glow.widgets.Panel","glow.net","glow.anim"],{async:true,onLoad:function(b){a=b;a.ready(d)}});var l=function(a){a=a||{};a.speed=a.speed||500;a.offset=a.offset||0;a.delay=a.delay||0;this.each(function(){new k(this,a)});return this}})()